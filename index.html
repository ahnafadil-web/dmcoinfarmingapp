<!DOCTYPE html>
<html lang="bn">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>DM COIN FARMING ‚Äî Global Firebase Version (With Withdraw)</title>

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/11.0.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/11.0.1/firebase-database-compat.js"></script>

<style>
:root{
  --bg:#0f0f11;--surface:#171718;--muted:#9aa0a6;--accent:#0a84ff;
  --success:#4caf50;--danger:#f44336;--card:#1f1f22;
  --font:"Inter",system-ui,Arial,sans-serif;
}
*{box-sizing:border-box}
body{margin:0;font-family:var(--font);background:var(--bg);color:#fff;min-height:100vh;display:flex;flex-direction:column}
header{display:flex;justify-content:space-between;align-items:center;padding:12px 16px;background:var(--surface);border-bottom:1px solid #222}
.balance{font-weight:700;font-size:1.1rem}
.small{color:var(--muted);font-size:0.85rem}
main{flex:1;overflow:auto;padding:16px}
.card{background:linear-gradient(180deg,rgba(255,255,255,0.02),rgba(255,255,255,0.01));padding:14px;border-radius:12px;margin-bottom:12px;border:1px solid rgba(255,255,255,0.03)}
.center{text-align:center}
.logo{width:110px;height:110px;border-radius:50%;display:block;margin:0 auto 10px;border:4px solid var(--accent);object-fit:cover}
.progress-wrap{background:#111;border-radius:10px;padding:4px}
.progress{height:10px;border-radius:8px;background:var(--success);width:0%;transition:width 0.3s linear}
button{background:var(--accent);border:none;padding:8px 12px;border-radius:10px;color:#fff;font-weight:600;cursor:pointer}
button.small{padding:4px 8px;font-size:0.8rem;margin:0 2px}
.nav{display:flex;gap:8px;justify-content:space-around;background:var(--surface);padding:10px;border-top:1px solid #222;position:sticky;bottom:0}
.nav button{flex:1;border-radius:8px;font-size:0.9rem}
.hidden{display:none}
.task-item{display:flex;justify-content:space-between;align-items:center;padding:10px;border-radius:8px;background:var(--card);margin-bottom:8px}
input,select{width:100%;padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:#fff;margin-top:8px}
.muted{color:var(--muted)}
table{width:100%;border-collapse:collapse;font-size:0.85rem;margin-top:8px}
th,td{border-bottom:1px solid rgba(255,255,255,0.06);padding:6px;text-align:left}
th{color:var(--muted)}
</style>
</head>

<body>
<header>
  <div>
    <div class="balance" id="coinBalance">üí∞ 0</div>
    <div class="small" id="farmStatus">Ready</div>
  </div>
  <div style="text-align:right">
    <div id="userName">User</div>
    <div class="small" id="userId">ID: -</div>
  </div>
</header>

<main>
  <!-- ü™ô FARM TAB -->
  <section id="farmTab" class="card center">
    <img class="logo" src="https://i.ibb.co/04PQkwb/IMG-3086.png" alt="logo">
    <h2>DM COIN FARMING</h2>
    <div class="progress-wrap" style="width:90%;margin:12px auto 8px">
      <div class="progress" id="farmProgress"></div>
    </div>
    <div id="farmTimer" class="muted">Ready to farm!</div>
    <div style="margin-top:10px"><button id="farmButton">Start Mining</button></div>
  </section>

  <!-- üß© TASKS TAB -->
  <section id="tasksTab" class="card hidden">
    <h3>Tasks</h3>
    <div id="taskList"></div>
  </section>

  <!-- ü§ù REFERRAL TAB -->
  <section id="referralTab" class="card hidden">
    <h3>Referral</h3>
    <p>Your referral link:</p>
    <input readonly id="refLink">
    <button onclick="copyRef()">Copy Link</button>
    <p class="muted">Invite friends & earn 500 coins each!</p>
  </section>

  <!-- üí∏ EXCHANGE TAB -->
  <section id="exchangeTab" class="card hidden">
    <h3>Exchange & Withdraw</h3>
    <input id="convertAmount" type="number" placeholder="Coins to convert">
    <button onclick="convertCoins()">Convert</button>
    <div id="convertedResult" class="muted" style="margin-top:6px"></div>
    <hr style="margin:10px 0;border:none;border-top:1px solid rgba(255,255,255,0.05)">
    <h4>Withdraw</h4>
    <input id="withdrawAmount" type="number" placeholder="Amount (coins)">
    <select id="withdrawMethod">
      <option value="solana">Solana</option>
      <option value="dmcoin">DM Coin</option>
    </select>
    <input id="withdrawAddress" placeholder="Wallet address">
    <button onclick="submitWithdraw()">Request Withdraw</button>
    <div style="margin-top:10px">
      <h4>History</h4>
      <div id="withdrawList" class="muted">No withdrawals yet.</div>
    </div>
  </section>

  <!-- üë§ PROFILE TAB -->
  <section id="profileTab" class="card hidden">
    <h3>Profile</h3>
    <div class="task-item"><div>User ID</div><div id="profileUserId">-</div></div>
    <div class="task-item"><div>Total Coins</div><div id="profileCoins">0</div></div>
    <div class="task-item"><div>Completed Tasks</div><div id="profileCompleted">0</div></div>
  </section>

  <!-- ‚öôÔ∏è ADMIN TAB -->
  <section id="adminTab" class="card hidden">
    <h3>Admin Panel</h3>
    <input id="adminEmail" placeholder="email">
    <input id="adminPass" type="password" placeholder="password">
    <button onclick="adminLogin()">Login</button>
    <div id="adminPanel" class="hidden" style="margin-top:12px">
      <h4>Global Mining Power</h4>
      <input id="miningPower" type="number" placeholder="Coins per minute">
      <button onclick="setMiningPower()">Update</button>

      <hr><h4>Add Task</h4>
      <input id="taskTitle" placeholder="Task Title">
      <input id="taskReward" type="number" placeholder="Reward (coins)">
      <input id="taskLink" placeholder="Task Link (URL)">
      <button onclick="addTask()">Add Task</button>

      <hr><h4>Withdraw Requests</h4>
      <div id="adminWithdraws" class="muted">Loading...</div>
    </div>
  </section>
</main>

<!-- üì± NAVIGATION -->
<nav class="nav">
  <button data-tab="farmTab">üè† Farm</button>
  <button data-tab="tasksTab">üìã Tasks</button>
  <button data-tab="referralTab">ü§ù Refer</button>
  <button data-tab="exchangeTab">üí∏ Exchange</button>
  <button data-tab="profileTab">üë§ Profile</button>
  <button data-tab="adminTab">‚öôÔ∏è Admin</button>
</nav>

<script>
/* ---------------- Firebase Setup ---------------- */
const firebaseConfig = {
  apiKey: "AIzaSyASWPlUEjeTOWVj-EShNtGaeeZQHMv3yxE",
  authDomain: "dm-coin-farming-point.firebaseapp.com",
  projectId: "dm-coin-farming-point",
  storageBucket: "dm-coin-farming-point.firebasestorage.app",
  messagingSenderId: "245444140845",
  appId: "1:245444140845:web:7480bfa27949c180e3bda4"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

/* ---------------- State ---------------- */
const ADMIN={email:"ahnafadilbsja@gmail.com",pass:"dmcoin2025"};
let state={global:{farmRate:100,farmingDurationMs:24*60*60*1000,coinToUsd:0.01},user:null};
let miningInterval=null;

/* ---------------- Helpers ---------------- */
function $(id){return document.getElementById(id);}
function saveUser(){localStorage.setItem('dm_user',JSON.stringify(state.user));}
function loadUser(){
  const data=localStorage.getItem('dm_user');
  if(data){state.user=JSON.parse(data);}else{
    state.user={id:'user_'+Math.floor(Math.random()*100000),coins:0,completedTasks:[],miningStart:null};
    saveUser();
  }
}
function updateUI(){
  $('coinBalance').innerText=`üí∞ ${Math.floor(state.user.coins)}`;
  $('userId').innerText='ID: '+state.user.id;
  $('profileUserId').innerText=state.user.id;
  $('profileCoins').innerText=Math.floor(state.user.coins);
  $('profileCompleted').innerText=state.user.completedTasks.length;
  renderWithdrawHistory();
  resumeMining();
}
document.querySelectorAll('.nav button').forEach(b=>b.addEventListener('click',()=>switchTab(b.dataset.tab)));
function switchTab(tab){document.querySelectorAll('main section').forEach(s=>s.classList.add('hidden'));$(tab).classList.remove('hidden');}

/* ---------------- Tasks (Realtime) ---------------- */
function listenTasks(){
  db.ref('tasks').on('value',snap=>{
    const data=snap.val()||{};
    renderTasks(Object.entries(data).map(([id,t])=>({...t,id})));
  });
}
function renderTasks(tasks){
  const el=$('taskList');el.innerHTML='';
  if(!tasks.length){el.innerHTML='<div class="muted">No tasks yet.</div>';return;}
  tasks.forEach(t=>{
    const done=state.user.completedTasks.includes(t.id);
    const div=document.createElement('div');div.className='task-item';
    div.innerHTML=`<div><strong>${t.title}</strong><div class="muted">${t.reward} üí∞</div></div>`;
    const btn=document.createElement('button');
    btn.innerText=done?'‚úÖ Done':'Complete';
    btn.disabled=done;
    btn.onclick=()=>handleTask(t);
    div.appendChild(btn);
    el.appendChild(div);
  });
}
function handleTask(t){
  if(state.user.completedTasks.includes(t.id))return;
  if(t.link)window.open(t.link,'_blank');
  setTimeout(()=>{
    state.user.completedTasks.push(t.id);
    state.user.coins+=parseInt(t.reward);
    saveUser();updateUI();
    alert(`+${t.reward} coins added`);
  },2000);
}

/* ---------------- Withdraw System ---------------- */
function submitWithdraw(){
  const amt=parseFloat($('withdrawAmount').value);
  const addr=$('withdrawAddress').value.trim();
  const method=$('withdrawMethod').value;
  if(!amt||!addr)return alert('Fill all fields');
  if(amt>state.user.coins)return alert('Not enough coins!');
  const ref=db.ref('withdraws').push();
  ref.set({user:state.user.id,amount:amt,method,address:addr,status:"Pending",time:Date.now()});
  state.user.coins-=amt;
  saveUser();updateUI();
  alert("Withdraw request sent!");
}
function listenWithdrawsAdmin(){
  db.ref('withdraws').on('value',snap=>{
    const data=snap.val()||{};
    renderAdminWithdraws(Object.entries(data).map(([id,w])=>({...w,id})));
  });
}
function renderWithdrawHistory(){
  db.ref('withdraws').orderByChild('user').equalTo(state.user.id).once('value',snap=>{
    const data=snap.val()||{};
    const el=$('withdrawList');
    if(!Object.keys(data).length){el.innerHTML='No withdrawals yet.';return;}
    let html='<table><tr><th>Amount</th><th>Method</th><th>Status</th></tr>';
    Object.values(data).forEach(w=>{
      html+=`<tr><td>${w.amount}</td><td>${w.method}</td><td>${w.status}</td></tr>`;
    });
    el.innerHTML=html+'</table>';
  });
}
function renderAdminWithdraws(list){
  const el=$('adminWithdraws');
  if(!list.length){el.innerHTML='No withdraw requests.';return;}
  let html='<table><tr><th>User</th><th>Amount</th><th>Method</th><th>Address</th><th>Status</th><th>Action</th></tr>';
  list.forEach(w=>{
    html+=`<tr><td>${w.user}</td><td>${w.amount}</td><td>${w.method}</td><td>${w.address}</td><td>${w.status}</td>
    <td><button class="small" onclick="updateWithdraw('${w.id}','Approved')">‚úÖ</button>
    <button class="small" style="background:#f44336" onclick="updateWithdraw('${w.id}','Rejected')">‚ùå</button></td></tr>`;
  });
  el.innerHTML=html+'</table>';
}
function updateWithdraw(id,status){
  db.ref('withdraws/'+id+'/status').set(status);
  alert('Withdraw '+status+'!');
}

/* ---------------- Admin ---------------- */
function adminLogin(){
  if($('adminEmail').value===ADMIN.email && $('adminPass').value===ADMIN.pass){
    $('adminPanel').classList.remove('hidden');
    listenWithdrawsAdmin();
  }else alert('Invalid login');
}
function addTask(){
  const title=$('taskTitle').value.trim();
  const reward=parseInt($('taskReward').value);
  const link=$('taskLink').value.trim();
  if(!title||!reward)return alert('Fill all fields');
  const id=db.ref().child('tasks').push().key;
  db.ref('tasks/'+id).set({title,reward,link});
  $('taskTitle').value='';$('taskReward').value='';$('taskLink').value='';
  alert('‚úÖ Task added globally!');
}
function setMiningPower(){
  const power=parseInt($('miningPower').value);
  if(!power||power<=0)return alert('Enter valid number');
  db.ref('global/farmRate').set(power);
  alert('Global mining power updated!');
}

/* ---------------- Mining System ---------------- */
function startMining(){
  if(state.user.miningStart)return alert("Mining already running!");
  state.user.miningStart=Date.now();saveUser();
  $('farmStatus').innerText='‚õè Mining started...';$('farmButton').disabled=true;
  runMining();
}
function runMining(){
  clearInterval(miningInterval);
  miningInterval=setInterval(()=>{
    const elapsed=Date.now()-state.user.miningStart;
    const duration=state.global.farmingDurationMs;
    const p=Math.min((elapsed/duration)*100,100);
    $('farmProgress').style.width=p+'%';
    const remaining=Math.max(0,duration-elapsed);
    $('farmTimer').innerText=`Time left: ${(remaining/3600000).toFixed(2)} hrs`;
    if(elapsed>=duration){
      clearInterval(miningInterval);
      const earned=state.global.farmRate*60*24;
      state.user.coins+=earned;
      state.user.miningStart=null;
      $('farmButton').disabled=false;
      $('farmStatus').innerText='‚úÖ Mining complete';
      $('farmTimer').innerText='You earned '+earned+' coins!';
      saveUser();updateUI();
    }
  },1000);
}
function resumeMining(){
  if(state.user.miningStart){
    const elapsed=Date.now()-state.user.miningStart;
    if(elapsed<state.global.farmingDurationMs){
      $('farmStatus').innerText='‚õè Mining resumed...';
      $('farmButton').disabled=true;
      runMining();
    }else{state.user.miningStart=null;saveUser();}
  }
}
$('farmButton').onclick=startMining;

/* ---------------- Exchange & Referral ---------------- */
function convertCoins(){
  const amt=parseFloat($('convertAmount').value);
  if(!amt||amt<=0)return alert('Enter amount');
  if(amt>state.user.coins)return alert('Not enough coins');
  const usd=amt*state.global.coinToUsd;
  $('convertedResult').innerText=`‚âà ${usd.toFixed(2)} USD`;
}
function copyRef(){
  const link=location.origin+location.pathname+'?ref='+state.user.id;
  navigator.clipboard.writeText(link);
  alert('Referral link copied!');
}

/* ---------------- INIT ---------------- */
loadUser();
updateUI();
listenTasks();
</script>
</body>
</html>

